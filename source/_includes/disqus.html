{% comment %} Load script if disquss comments are enabled and `page.comments` is either empty (index) or set to true {% endcomment %}
{% if site.disqus_short_name and page.comments != false %}
<script id="dsq-count-scr" src="//{{ site.disqus_short_name }}.disqus.com/count.js" async></script>
{% if page.comments == true %}
  {% comment %} `page.comments` can be only be set to true on pages/posts, so we embed the comments here. {% endcomment %}
<script type="text/javascript">
  var disqus_config = function () {
      this.page.url = '{{ site.url }}{{ page.url }}';
      this.page.identifier = '{{ site.url }}{{ page.url }}';
      this.page.title = '{{ page.title }}';
  };

  (function() {
      var d = document, s = d.createElement('script');

      s.src = '//{{ site.disqus_short_name }}.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
  })();
</script>
{% endif %}
{% endif %}
